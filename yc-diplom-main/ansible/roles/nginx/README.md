Nginx and certbot
=========

Установка Nginx и certbot(для автоматизаци получения Let’s Encrypt сертификатов), получение сертификата, а также его обновление. Также роль настраивает NAT для reverse proxy. После выполнения всех tasks - уходит в sleep на 2 минуты, чтобы nginx без спешки успел перезапуститься и начать работать с новым конфигом.

Requirements
------------

Ubuntu

Переменные
--------------

| Variable name | Default | Description |
|--------------|-----------------------------|------------------------------------------------|
| domain | apvanyushin.ru | Домен |

Templates
------------

`http.j2` - конфиг nginx для работы по http, для отладки(проверить что nginx работает с нужным конфигом и отображает нужную страницу) используется простая html страница

`http_301.j2` - После получения сертификата перезаписывает конфиг `http.j2`, редирект всего http трафика на https

`https.j2` - конфиг nginx для работы по https всех сервисов проекта, настроен upstream

Example Playbook
----------------

    - hosts: servers
      roles:
         - nginx

